From 3f3e8a2e2c57c681a999a73f68241f90678c3825 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?J=C3=B6rg=20Thalheim?= <joerg@thalheim.io>
Date: Sat, 24 Jan 2026 06:53:28 +0100
Subject: [PATCH] PostgresInstaller: Handle null password in
 openConnectionToAnyDB
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

When using peer authentication, the password may be null. This causes
a type error since the function expects a string. Accept nullable
password and default to empty string.

Bug: https://phabricator.wikimedia.org/T414884
Signed-off-by: JÃ¶rg Thalheim <joerg@thalheim.io>
---
 includes/installer/PostgresInstaller.php | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/includes/installer/PostgresInstaller.php b/includes/installer/PostgresInstaller.php
index 9650187a5d0..c880b3a270e 100644
--- a/includes/installer/PostgresInstaller.php
+++ b/includes/installer/PostgresInstaller.php
@@ -156,7 +156,8 @@ class PostgresInstaller extends DatabaseInstaller {
 		return $status;
 	}
 
-	public function openConnectionToAnyDB( string $user, string $password ): ConnectionStatus {
+	public function openConnectionToAnyDB( string $user, ?string $password ): ConnectionStatus {
+		$password = $password ?? '';
 		$dbs = [
 			'template1',
 			'postgres',
-- 
2.52.0

